rm(list=ls())
library("bdt")

bdtDatasetsDir = 'C:/work/bdtDatasets'
thisScriptDir = 'C:/work/BDT/examples/R/bdvd/dukeUwExonArray'
bdt_home = 'C:/work/BDT/build/windows/install'

sample_groups = list(
  c(1,2,3,4,158,159,160),
  c(5,6,7,177,178,179),
  c(8,9,10,155,156),
  c(11,12,13,184,185,186),
  c(14,15,169,170),
  c(16,17,192),
  c(18,19,20,21),
  c(22,23),
  c(24,25),
  c(26,27),
  c(28,29),
  c(30,31),
  c(32,33,34),
  c(35,36),
  c(37,38),
  c(39,197,198),
  c(40,41,42),
  c(43,44),
  c(45,46,47,284,285,286,287),
  c(48,49,50),
  c(51,52,53),
  c(54),
  c(55,56),
  c(57,58,59,60),
  c(61,62),
  c(63,64,275,276),
  c(65,66),
  c(67,68,288,289),
  c(69,70,71),
  c(72,73,74,75),
  c(76,77,199,200,201),
  c(78,79),
  c(80,81),
  c(82,83),
  c(84,85),
  c(86,87),
  c(88,89),
  c(90,91),
  c(92,93),
  c(94,95),
  c(96,97),
  c(98),
  c(99,100),
  c(101,102,103,215,216),
  c(104,105,106),
  c(107,108),
  c(109,110),
  c(111,112,113,114),
  c(115,116),
  c(117,118),
  c(119,120),
  c(121,122,123),
  c(124,125,126),
  c(127,128,129),
  c(130,131,132),
  c(133,134,135),
  c(136,137),
  c(138,139),
  c(140,141),
  c(142),
  c(143),
  c(144,145,146),
  c(147,148),
  c(149,150),
  c(151,152),
  c(153,154),
  c(157),
  c(161,162,163),
  c(164,165),
  c(166,167,168),
  c(171,172),
  c(173,174,175),
  c(176),
  c(180,181),
  c(182,183),
  c(187,188),
  c(189,190,191),
  c(193,194),
  c(195,196),
  c(202,203),
  c(204,205),
  c(206,207),
  c(208,209),
  c(210,211),
  c(212,213),
  c(214),
  c(217,218),
  c(219,220),
  c(221,222),
  c(223,224),
  c(225,226),
  c(227,228),
  c(229,230),
  c(231,232),
  c(233,234),
  c(235,236),
  c(237,238),
  c(239,240),
  c(241,242),
  c(243,244),
  c(245,246),
  c(247,248),
  c(249,250),
  c(251,252),
  c(253,254),
  c(255,256),
  c(257,258),
  c(259,260),
  c(261,262),
  c(263,264),
  c(265,266),
  c(267,268),
  c(269,270),
  c(271,272),
  c(273,274),
  c(277,278),
  c(279),
  c(280,281),
  c(282,283),
  c(290,291),
  c(292,293),
  c(294),
  c(295,296),
  c(297,298),
  c(299,300),
  c(301,302),
  c(303,304),
  c(305),
  c(306,307),
  c(308,309),
  c(310),
  c(311,312),
  c(313,314),
  c(315,316),
  c(317,318),
  c(319,320),
  c(321,322),
  c(323),
  c(324,325),
  c(326,327),
  c(328,329),
  c(330,331),
  c(332,333,334))

## group level
export_columns = sapply(sample_groups, function(g) g[1])
ret = bdvdExport(
    bdt_home = bdt_home,
    column_ids = export_columns,
    bdvd_dir = paste0(thisScriptDir,"/01-out"),
    component = 'signal',
    unwanted_factors = 2,
    rowidxs_input = paste0("text-rowids@",thisScriptDir,"/03-rowidxs.txt"),
    rowidxs_index_base = 1,
    out = paste0(thisScriptDir,"/03-out"))

mat = readMat(ret$mats[[1]])